<!DOCTYPE html>
<!--
    So Simple Jekyll Theme 3.2.0
    Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
    Free for personal and commercial use under the MIT license
    https://github.com/mmistakes/so-simple-theme/blob/master/LICENSE
-->
<html lang="en-US" class="no-js">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  

  
    <title>Praxistipps zu ftplicity</title>
    <meta name="description" content="Ich nutze seit geraumer Zeit &quot;ftplicity&quot; für das Backup meiner Server auf einen FTP-Backupserver. In diversen Artikeln u.a. bei heise.de (&quot;Hinter Schloss und...">
    <link rel="canonical" href="https://aheusingfeld.github.io/hosting/praxistipps-zu-ftplicity/">
  

  <script>
    /* Cut the mustard */
    if ( 'querySelector' in document && 'addEventListener' in window ) {
      document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + 'js';
    }
  </script>

  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="/assets/css/skins/default.css">
  
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,700,700i|Lora:400,400i,700,700i">
  <link rel="alternate" type="application/atom+xml" title="Overthinker&#39;s Thoughts" href="/feed.xml">
<!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

</head>


  <body class="layout--single  praxistipps-zu-ftplicity">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#primary-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    
  <div class="navigation-wrapper">
    <a href="#menu-toggle" id="menu-toggle">Menu</a>
    <nav id="primary-nav" class="site-nav animated drop">
      <ul><li><a href="/posts/">Blog</a></li><li><a href="/categories/talks">Talks</a></li><li><a href="/tags/">Tags</a></li><li><a href="/about/">About Me</a></li></ul>
    </nav>
  </div><!-- /.navigation-wrapper -->


    <header class="masthead">
  <div class="wrap">
    
      <a href="/" class="site-logo" rel="home" title="Overthinker's Thoughts">
        <img src="/gfx/alex-blog.jpg" class="site-logo-img animated fadeInDown" alt="Overthinker's Thoughts">
      </a>
    
    
    
      
        <div class="site-title animated fadeIn"><a href="/">Overthinker's Thoughts</a></div>
      
      <p class="site-description animated fadeIn" itemprop="description">My 2cts on software architecture, digital transformation, and other concerns</p>
    
  </div>
</header><!-- /.masthead -->


    <div id="main" role="main" class="main-content" aria-label="Content">

  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    

    <div class="page-wrapper">
      <header class="page-header">
        
        
          <h1 id="page-title" class="page-title p-name">Praxistipps zu ftplicity
</h1>
        
        

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2011-06-05T23:00:00+02:00">2011-06-05</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


      </header>

      <div class="page-content">
        <div class="e-content">
          <p>
Ich nutze seit geraumer Zeit "ftplicity" für das Backup meiner Server auf einen FTP-Backupserver. In diversen <a href="http://www.howtoforge.de/howto/erstellen-von-verschlusselten-ftp-backups-mit-duplicity-und-ftplicity-auf-debian-etch/" target="_blank">Artikeln</a> u.a. bei heise.de (<a href="http://www.heise.de/security/artikel/Hinter-Schloss-und-Siegel-270834.html" taret="_blank">"Hinter Schloss und Siegel"</a>) wird genau beschrieben, wie man so ein Backup auch verschlüsselt für einen nicht vertrauenswürdigen Backupserver einrichtet.<br />


pass::[more]


Mein Backup wird durch die folgenden crontab-Einträge gesteuert:<br /><pre># run the (incremental) backup each night at 05:11h<br />11 5 * * 1-6 /usr/local/bin/ftplicity backup &amp;&gt; /var/log/ftplicity_incremental.log<br />25 5 * * 1-6 /root/bin/checkBackupSize.sh | mail -s "ftplicity backup status" MY@MAIL.de<br /># do a full backup every sunday &amp; delete old backups<br />45 3 * * 0 /usr/local/bin/ftplicity full &amp;&gt; /var/log/ftplicity_full.log<br />35 4 * * 0 /usr/local/bin/ftplicity purge --force &amp;&gt;&gt; /var/log/ftplicity_full.log<br />25 5 * * 0 mail -s "ftplicity_full.log" MY@MAIL.de &lt; /var/log/ftplicity_full.log<br /></pre>Über die Zeit habe ich aber gemerkt, dass eine Punkte nicht beschrieben sind.  <br /><h3>Wie kann ich mir den belegten Backupspeicher ansehen?</h3>Um den Hintergrund dieser Frage besser einschätzen zu können, muss man wissen, dass <br /><ol style="margin-left: 1em;"><li>die meisten Backupserver eine Quota für die Benutzer einrichten</li><li>zum Löschen einer Datei via FTP der gleiche Platz auf dem Server/ der Quota frei sein muss, wie die Datei bereits belegt</li></ol>Vor diesem Hintergrund bedeutet dies, dass man eine 10MB große Datei nicht löschen kann, wenn in der Quota nur noch 9MB frei sind! Aus diesem Grund kann es passieren, dass man obsolete Backups nach erfolgreichem Fullbackup nicht mehr löschen kann, wenn nicht genauso viel Speicher in der Quota frei ist, wie gelöscht werden soll.  Zur Anzeige des belegten Speichers auf dem entfernten FTP-Server verwende ich als Workaround folgendes Perl-Skript: <br /><pre>#!/bin/sh <br /># Location: /root/bin/checkBackupSize.sh<br /># Prints the size of all files on the remote FTP server to STDOUT<br /><br />ftp -n u30754.your-backup.de &lt;&lt;EOT  | perl -ne '$_=~/u30754   u30754   (\d+) /; $cnt=$cnt+$1; print $cnt."\n"' | tail -n 1 | perl -ne 'print "Current size of backup is " . $_/1024/1024 . " MB\n"'<br />user u30754 A0Lr7NEIvEeFxMDw<br />dir <br />quit <br />EOT<br /></pre><br /><h3>Wie funktioniert der Parameter "HOECHSTALTER"?</h3>Dieser Parameter soll eigentlich das Alter der ältesten Datei markieren. Bei einem Aufruf von "ftplicity purge" wird dementsprechend versucht alle Dateien zu löschen, die älter als 7 Tage sind. Full-Backups können allerdings nur gelöscht werden, wenn es keine inkrementellen Backups mehr gibt, die von ihnen abhängen. <br /><br />Stellt man in der "~/.ftplicity/conf" das "HOECHSTALTER=7D", ruft aber nur alle 14 Tage ein "ftplicity full" auf, so werden auf dem Backup-Server die Dateien der inkrementellen Backups der letzten 14 Tage nicht löschbar sein!<br /><br />Dies sollte vor allem in Zusammenhang mit o.g. Tipp bzgl. "belegter Backupspeicher" beachtet werden.
</p>

        </div>

        <footer class="page__meta">
          
          <!-- 
  <h3 class="page-taxonomies-title">Categories</h3>
  <ul class="page-taxonomies"><li class="page-taxonomy">hosting</li>
  </ul>

 -->
          
  <h3 class="page-taxonomies-title">Tags</h3>
  <ul class="page-taxonomies"><li class="page-taxonomy">ftplicity</li><li class="page-taxonomy">duplicity</li><li class="page-taxonomy">ubuntu</li><li class="page-taxonomy">linux</li><li class="page-taxonomy">self-hosting</li><li class="page-taxonomy">backup</li><li class="page-taxonomy">security</li>
  </ul>


          

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2011-06-05T23:00:00+02:00">2011-06-05</time></p>


        </footer>
        
          <div class="page-share">
  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Faheusingfeld.github.io%2Fhosting%2Fpraxistipps-zu-ftplicity%2F" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" class="btn btn--facebook btn--small"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i> <span>Share</span></a>
  <a href="https://twitter.com/intent/tweet?text=Praxistipps+zu+ftplicity%20https%3A%2F%2Faheusingfeld.github.io%2Fhosting%2Fpraxistipps-zu-ftplicity%2F" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" class="btn btn--twitter btn--small"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i> <span>Tweet</span></a>
  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Faheusingfeld.github.io%2Fhosting%2Fpraxistipps-zu-ftplicity%2F" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" class="btn btn--linkedin btn--small"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> <span>LinkedIn</span></a>
  <a href="https://reddit.com/submit?title=Praxistipps+zu+ftplicity&url=https%3A%2F%2Faheusingfeld.github.io%2Fhosting%2Fpraxistipps-zu-ftplicity%2F" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" class="btn btn--reddit btn--small"><i class="fab fa-fw fa-reddit" aria-hidden="true"></i> <span>Reddit</span></a>
</div>

        

        

        <nav class="page-pagination" role="navigation">
  
    <a class="page-previous" href="/productivity/how-to-set-default-comment-security-level-in-atlassian-jira/">
      <h4 class="page-pagination-label">Previous</h4>
      <span class="page-pagination-title">
        <i class="fas fa-arrow-left"></i> How to Set Default Comment Security Level in Atlassian JIRA

      </span>
    </a>
  

  
    <a class="page-next" href="/software%20development/starting-photooapp-a-springroo-tutorial-application/">
      <h4 class="page-pagination-label">Next</h4>
      <span class="page-pagination-title">
        Starting PhotooApp - A SpringRoo tutorial application
 <i class="fas fa-arrow-right"></i>
      </span>
    </a>
  
</nav>

      </div>
    </div>
  </article>
</main>


    <footer id="footer" class="site-footer">
  <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
<div class="social-icons"><a class="social-icon" href="/feed.xml"><i class="fas fa-rss-square fa-2x" title="Feed"></i></a><a class="social-icon" href="/imprint"><i class="fas fa-info fa-2x" title="Imprint & Privacy"></i></a><a class="social-icon" href="https://speakerdeck.com/u/aheusingfeld"><i class="fab fa-fw fa-slideshare fa-2x" title=""></i></a><a class="social-icon" href="https://mstdn.social/@aheusingfeld"><i class="fas fa-user fa-2x" title=""></i></a></div><div class="copyright">
    
      <p>&copy; 2023 Alexander Heusingfeld. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://github.com/mmistakes/so-simple-theme" rel="nofollow">So Simple</a>.</p>
    
  </div>
</footer>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <script src="/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.0.12/js/all.js"></script>


  </body>

</html>
