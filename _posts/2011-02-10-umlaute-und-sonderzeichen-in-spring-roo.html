---
layout: post
title: Umlaute und Sonderzeichen in Spring Roo?
label: umlaute-spring-roo
date: 2011-02-10
comments: false
---

<p>
Dies ist der erste in einer Reihe von Blog-Posts über Spring Roo (Erläuterung siehe unten).<br />[<a href="http://goldstifts.blogspot.com/2011/02/broken-special-chars-in-spring-roo.html">english version</a>]<br /><h2> Problem: Sonderzeichen und Umlaute werden in meiner Roo-Anwendung nicht korrekt angezeigt</h2><br />Im <a href="http://forum.springsource.org/forumdisplay.php?f=67">Spring Roo-Forum</a> gibt es öfter Anfragen, die o.g. Problem beschreiben, dass deutsche Umlaute wie ä, ö, ü und ß nicht korrekt gespeichert oder "kaputt" übertragen werden. Im Folgenden möchte ich kurz die häufigsten Fehlerquellen und Lösungen aufzeigen.<br /><h3> Zeichensatz der HTML-/ JSP-Seite</h3>Durch Roo generierte JSPs werden immer im Zeichensatz UTF-8 ausgeliefert. Schreibt man eigene JSPs bspw. mit Formularen, sollte diese HTML bzw. JSP-Seite als Zeichensatz ebenfalls UTF-8 verwenden. Dies erreicht man in dem am Anfang der JSP die folgende Zeile eingefügt wird:<br /><pre>&lt;jsp:directive.page contenttype="text/html;charset=UTF-8"<br />   pageencoding="UTF-8"/&gt;<br /></pre><br />Am Anfang der "default.jspx", die über Apache Tiles als "Rahmen" für alle anderen JSP-Seiten gilt, sind z.B. folgende Angaben zum Encoding/ Zeichensatz enthalten:<br /><pre class="alt2" dir="ltr" style="border: 1px inset; margin: 0px; overflow: auto; padding: 6px; text-align: left; width: 400px;">&lt;html xmlns:jsp="http://java.sun.com/JSP/Page" xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:tiles="http://tiles.apache.org/tags-tiles" xmlns:spring="http://www.springframework.org/tags" xmlns:util="urn:jsptagdir:/WEB-INF/tags/util" &gt;  <br /> <br /> &lt;jsp:output doctype-root-element="HTML" doctype-system="about:legacy-compat" /&gt;<br /> <br /> &lt;jsp:directive.page contentType="text/html;charset=UTF-8" /&gt;  <br />  <br /> &lt;head&gt;<br />  &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /&gt;<br /><br />&lt;!-- ... --&gt;<br /></pre><br />Ist sichergestellt, dass die Seiten im Zeichensatz "UTF-8" ausgeliefert werden (dies kann im Browser meist im Menüpunkt "Ansicht &gt; Zeichensatz" kontrolliert werden), die Sonderzeichen werden aber trotzdem falsch übertragen, ist dies nicht die Fehlerursache.<br /><br /><h3> CharacterEncodingFilter in der web.xml</h3>Dieser Punkt ist der häufigste Fehler. Es geht hierbei um die Reihenfolge der <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&lt;filter-mapping&gt;</span>-Tags in der Datei "<span style="font-family: &quot;Courier New&quot;,Courier,monospace;">web.xml</span>". Diese Tags geben an, in welcher Reihenfolge die einzelnen Filter bei einem HTTP-Request durchlaufen werden.<br /><b>Roo generiert leider erst <a href="https://jira.springsource.org/browse/ROO-1731">seit Version 1.1.1 per Default die korrekte Reihenfolge, wie folgt aussieht</a>: </b><br /><br /><pre class="alt2" dir="ltr" style="border: 1px inset; margin: 0px; overflow: auto; padding: 6px; text-align: left; width: 400px;">&lt;filter-mapping&gt;<br />    &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt;<br />    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;<br />&lt;/filter-mapping&gt;<br />&lt;filter-mapping&gt;<br />    &lt;filter-name&gt;Spring OpenEntityManagerInViewFilter&lt;/filter-name&gt;<br />    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;<br />&lt;/filter-mapping&gt;<br />&lt;filter-mapping&gt;<br />    &lt;filter-name&gt;HttpMethodFilter&lt;/filter-name&gt;<br />    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;<br />&lt;/filter-mapping&gt;<br />&lt;filter-mapping&gt;<br />    &lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;<br />    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;<br />&lt;/filter-mapping&gt;<br /></pre><br />Will man die Reihenfolge der Filter ändern, ist es wichtig, deren Bedeutung zu verstehen:<br /><ul><li><a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/filter/CharacterEncodingFilter.html">CharacterEncodingFilter</a> - Setzt den Zeichensatz des Requests, falls der Browser ihn nicht mitsendet</li><li> <a href="http://static.springsource.org/spring/docs/3.0.x/api/org/springframework/orm/jpa/support/OpenEntityManagerInViewFilter.html">OpenEntityManagerInViewFilter</a> - nur in Verbindung mit Hibernate, setzt EntityManager in ThreadLocal (siehe <a href="http://stackoverflow.com/questions/1538222/why-not-to-use-springs-openentitymanagerinviewfilter">Diskussion über</a> <a href="http://heapdump.wordpress.com/2010/04/04/should-i-use-open-session-in-view/">Vor- und Nachteile</a>)</li><li><a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/filter/HiddenHttpMethodFilter.html">HttpMethodFilter</a> - Notwendig um bspw. PUT oder DELETE abbilden zu können</li><li><a href="http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/web/filter/DelegatingFilterProxy.html">springSecurityFilterChain</a> - muss nach HttpMethodFilter kommen, wenn auf HTTP-Method eingeschränkt wird</li><li>... ggf. weitere Filter</li></ul>Damit Fehler in der Behandlung von Texten mit Sonderzeichen ausgeschlossen werden, sollte der "CharacterEncodingFilter" durchlaufen worden sein, bevor die Requestdaten in irgendeiner Form weiterverarbeitet werden.<br /><b>Aus diesem Grund lautet die Empfehlung: das &lt;filter-mapping&gt; für den <a href="http://forum.springsource.org/showthread.php?t=97672">CharacterEncodingFilter muss in der "web.xml" an erster Stelle stehen</a> (<a href="https://jira.springsource.org/browse/ROO-1698">Erklärung siehe ROO-1698</a>)!</b> <br /><h3> Datenbankverbindung</h3>Zu guter Letzt sollte sichergestellt werden, dass auch die Kommunikation mit der Datenbank über Unicode bzw. mit dem Standardzeichensatz UTF-8 geführt wird.<br /><br />Kommt als Datenbank bspw. MySQL zum Einsatz, generiert Roo automatisch die Unicode-Unterstützung über folgende Konfiguration in der Datei "<span style="font-size: x-small;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">src/main/resources/META-INF/spring/database.properties</span></span>":<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">database.url=jdbc:mysql://[YOUR_DB_SERVER]:3306/[YOUR_DB_NAME]?autoReconnect=true&amp;useUnicode=true&amp;characterEncoding=UTF-8</span><br /><br /><h3> Fazit</h3>Seit Version 1.1.1 verfügt Spring Roo über eine (bisher) fehlerfreie Unterstützung für Sonderzeichen, die bereits in diversen Sprachen getestet wurde.<br />Bei Fragen und Problemen findet man im Roo-Forum auf jeden Fall kompetente Hilfe. <br /><br /><h3> Im Text verwendete, weiterführende Links</h3><ul style="font-family: inherit;"><li><a href="https://jira.springsource.org/browse/ROO">ROO-JIRA issues</a></li><ul><li><a href="https://jira.springsource.org/browse/ROO-89">https://jira.springsource.org/browse/ROO-89</a> </li><li><a href="https://jira.springsource.org/browse/ROO-1030">https://jira.springsource.org/browse/ROO-1030</a></li><li><a href="https://jira.springsource.org/browse/ROO-1585">https://jira.springsource.org/browse/ROO-1585</a>&nbsp; </li><li><a href="https://jira.springsource.org/browse/ROO-1684">https://jira.springsource.org/browse/ROO-1684</a></li><li><a href="https://jira.springsource.org/browse/ROO-1698">https://jira.springsource.org/browse/ROO-1698</a> </li><li><a href="https://jira.springsource.org/browse/ROO-1731">https://jira.springsource.org/browse/ROO-1731</a></li></ul><li>Threads im <a href="http://forum.springsource.org/forumdisplay.php?f=67">ROO-Forum</a></li><ul><li><a href="http://forum.springsource.org/showthread.php?t=101926">http://forum.springsource.org/showthread.php?t=101926</a>&nbsp;</li><li><a href="http://forum.springsource.org/showthread.php?t=97672">http://forum.springsource.org/showthread.php?t=97672</a></li></ul><li>Sonstige</li><ul><li><a href="http://heapdump.wordpress.com/2010/04/04/should-i-use-open-session-in-view/">http://heapdump.wordpress.com/2010/04/04/should-i-use-open-session-in-view/</a></li><li><a href="http://stackoverflow.com/questions/1538222/why-not-to-use-springs-openentitymanagerinviewfilter">http://stackoverflow.com/questions/1538222/why-not-to-use-springs-openentitymanagerinviewfilter</a><br /></li></ul></ul><br /><blockquote><a href="http://www.springsource.org/roo">Spring Roo</a> ist ein Code-Generierungs-Werkzeug für die Softwareentwicklung, welches Entwickler in die Lage versetzt schnell und unkompliziert vorzeigbare Ergebnisse bspw. in Form von benutzbaren Prototypen zu liefern. Im Gegensatz zu anderen Werkzeugen, Frameworks und Tools entwickelt man mit Spring Roo zu 100% in Java.<br /><br />Für die Anpassung oder Erweiterung von Roo bspw. durch eigene Add-Ons kann auf vorhandenes Java-Wissen und -Erfahrung aufgebaut werden. Unterstützt durch die geringen Einstiegshürden und die hohe Modularisierung, kann so jedes Projekt leicht an die ganz speziellen, individuellen Bedürfnisse angepasst und einmal geschriebene Komponenten oder Add-Ons wiederverwendet werden.<br /><br /></blockquote>Update 12.02.2011 23:50h:<br /><ul><li>Frage eingearbeitet: "Setzt Roo diese Einstellungen automatisch oder muss man diese selbst anpassen?" - siehe Fazit</li><li>verschiedene Verbesserungsvorschläge eingearbeitet und Tippfehler korrigiert</li></ul>
</p>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
super, hat mir sehr geholfen.<br />GRüsse Stefan</div>
</div>
</div>
